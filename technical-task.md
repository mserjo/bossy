# technical-task.md

Бонусна система в межах групи (нагороди/бонуси/штрафи за виконання завдань та за події).
Робоча Назва: Bossy
Запасні варіанти: Kudos/Incentive/Laudis/Virtus (або запропонуй свій варіант, можливо на латині).

Основні технології (можеш додати ще необхідні бібліотеки та технології):
backend: Python 3.13, FastAPI, PostgreSQL v16, Pydantic v2, SQLAlchemy v2, pytest, alembic
frontend: Flutter, flutter_test
CI/CD: Jenkins

Вимоги до системи:
- Асинхронність
- Кросс-платформність (Android, iOS, Windows, Web, Ubuntu)
- Аутентифікація - JWT токени + refresh токени
- Нотифікації - внутрішні в додатку
- Логування backend (logger) та frontend
- Використання docker та docker-compose
- Підтримка різних мов (одразу переклади для англійської, української) і UI, і контент, і помилки, і сповіщення (JSON)
- Різні теми оформлення frontend
- backend - Індекси для поліпшення продуктивності
- backend - Винесення в базові класи спільні поля/методи/правила
- backend - Валідація даних (Pydantic)
- Можливість синхронізації з Google Calendar, Outlook та інші календарі
- Можливість сповіщень через месенджери (Telegram/Viber/Slack/Teams/WhatsApp та інші)
- колекція Postman для тестування API
- API для зовнішніх систем
- Безпека - Rate Limiting, Security Headers, і т.д.
- Health Check API
- підтримка завантаження файлів (аватари, іконки груп/нагород), локально
- покриття тестами всього коду (backend та frontend)
- Redis для черг/кешування (закласти можливість використання. винести в налаштування використовувати чи ні)
- Celery (закласти можливість використання. винести в налаштування використовувати чи ні)
- Firebase Cloud Messaging (закласти можливість використання. винести в налаштування використовувати чи ні)
- Android та Apple Push Notification service (закласти можливість використання. винести в налаштування використовувати чи ні)
- Elasticsearch (закласти можливість використання. винести в налаштування використовувати чи ні)
- Інтеграція з таск-трекерами - Jira, Trello і т.д. (закласти можливість використання. винести в налаштування використовувати чи ні)
- детальна візуальна діаргама технологій, структури моделей, бази даних, бізнес-процесів (бажано PowerDesigner - BPM, PDM, Component Diagram)

------------------------------------------------------------------------------------------------------------------------
Основні об'єкти (для кожного окрема модель):
- системні задачі
- налаштування системи (+ моніторинг)
- налаштування групи
- довідники
- користувачі
- групи
- завдання/події
- виконання завдань
- нагороди
- рахунки користувачів
- транзакції по рахунках
- повідомлення
- звіти

Довідники (для кожного окрема модель, налаштовує superadmin)
- статуси
- ролі користувачів
- типи груп
- типи завдань
- типи бонусів (обирається і налаштовується в налаштуваннях групи адміном групи)
- зовнішні інтеграції (месенджерів/календарів/інше)
- (довідник чи enum) типи користувачів

Для кожного об'єкта доступно:
- переглянути список/детально
- створити
- редагувати
- видалити
- змінити статус

------------------------------------------------------------------------------------------------------------------------
Системні задачі (cron)
- усі системні задачі виконуються під користувачем shadow (системний бот-адмін)
- системні задачі можуть бути періодичними або разовими
- (superadmin) перегляд список/детально/створення/редагування/видалення
- розсилка повідомлень (email, sms, месенджери)
- очищення логування (старіші за вказану кількість днів)
- відрізання і пакування логування (старіші за вказану кількість днів)
- (адмін групи) створення завдання "Привітати з днем народження", нарахування бонусів за річницю в групі, і т.д. (в налаштуваннях групи)
- і т.д.

Налаштування системи:
- (superadmin) налаштування всієї системи; доступів для ролей; довідників; груп; користувачів; моніторинг
- (superadmin) зробити резервну копію системи
- (superadmin) відновити систему з резервної копії
- (superadmin) створення/налаштування шаблонів груп (групи з передвизначеними налаштуваннями, типами завдань та нагородами для швидкого розгортання нових схожих груп)
- (superadmin) звіт - групи без користувачів (покинуті групи)
- (superadmin) звіт - неактивні групи

Налаштування групи:
- відноситься до одної конкретної групи
- (superadmin/адмін групи) налаштування групи (назва групи, ієрархія груп, назва валюти бонусів, бонуси цілі чи дробові, максимальний розмір боргу, і т.д.)

Довідники:
- загальні для всіх
- (superadmin) створення/редагування/видалення
- (всі ролі) перегляд список/детально

Користувач:
- (адмін групи) створення/редагування/видалення/блокування/підтвердження користувача (додавати нового з ролями "користувач"/"адмін", або змінювати роль користувачу в групі)
- (адмін групи) відправити запрошення користувача на приєднання доя групи за посиланням/QR-коду (унікальний в рамках групи)
- (всі ролі) авторизація, реєстрація за поштою/телефоном та інше, нагадування пароль, відновлення пароля
- (всі ролі) після авторизації, користувачу виводиться для вибору: створення нової групи та список груп до яких у нього є доступ (з вказанням ролі в цій групі)
- (всі ролі) користувач, який створив групу автоматично стає адміном групи
- (всі ролі) налаштування свого профіля - детальна інформація, фото, аватарка, оформлення і т.д. (загальна для всіх доступних груп)
- (всі ролі) налаштування свого профіля - сповіщення, повідомлення, інтеграції і т.д. (загальна для всіх доступних груп або окремо для кожної доступної групи)
- (всі ролі) в своєму профілі користувач може бачити список всіх своїх рахунків з залишками в різних групах
- (всі ролі) в своєму профілі користувач може бачити організаційну ієрархію (назви груп з іменами адмінів груп в структурі, до якої відноситься обрана при вході група)
- (всі ролі) перегляд виписки по своїх рахунках, звіти, рейтинги в рамках доступних груп
- (всі ролі) можна мати доступ до багатьох груп (в різних групах може мати роль користувач/адмін групи)
- якщо адмін групи видалив користувача, то видаляється лише зв'язка "користувач - група" (в інших групах користувач залишається з тою ж роллю)
- користувачам можуть надаватися рівні, бейджі, прогрес-бари за виконану кількість завдань/подій або накопиченими/заробленими бонусами (налаштовується в адміном групі) і т.д.
- різні рейтинги користувачів: за кількістю виконаних завдань; за накопиченими/заробленими бонусами в групі; і т.д. (в групі)
- користувачам (за бажанням) може робити частину свого профілю та активності видимою для інших учасників групи, створюючи своєрідну соціальну стрічку

+ додаткова таблиця (користувач - група - роль)

Група:
- при створенні групи, адмін обирає серед існуючих шаблонів груп (з можливістю в подальшому змінювати налаштування), або заповнює все сам
- групи можуть бути ієрархічними (одна група може мати підпорядковані групи - організаційна ієрархія, структура).
в такому випадку адмін вищої групи має доступ та повноваження адміна в усіх підпорядкованих, а адмін з підпорядкованої групи не має доступу до вищої групи
- (адмін групи) створення/редагування/видалення
- (адмін групи) масова розсилка повідомлень (внутрішніх, а також на месенджери/пошту) в рамках групи
- (адмін групи) опитування/голосування користувачів групи
- (всі ролі в рамках групи) перегляд інформації групи, а також повну ієрархію, якщо є
- (всі ролі в рамках групи) покинути групу, звіти, рейтинги
- адмін групи не може покинути групу, якщо він один адмін в цій групі і є ще інші користувачі

Завдання/події:
- належить до якоїсь групи
- (адмін групи) створення/редагування/видалення
- (адмін групи) важливі параметри:
завдання чи подія (подію не треба брати в роботу і виконувати, вона настає автоматично - наприклад, "спізнився на роботу");
скільки бонусів за виконання; який штраф за невиконання (не обов'язково);
одноразове чи постійне (тобто при виконанні, завдання/подія не закривається, а може бути виконане вказану кількість разів або без обмеження кількістю разів);
з терміном виконання або без; обов'язкове для виконання або ні;
може брати у виконання тільки один користувач (хто перший взяв у виконання), або багато користувачів одночасно;
бонуси за виконання отримує тільки перший хто виконав, або усі хто виконав;
- (всі ролі в рамках групи) перегляд список/детально; дія "взяти у роботу"/"виконано"/"відмовитися"
- (всі ролі в рамках групи) можна залишати відгуки на завдання/події та ставити рейтинги (ця можливість налаштовується адміном в групі)
- завдання/події можуть бути ієрархічними (одна задача може мати підзадачі)
- завдання/події можуть бути з негативними бонусами (штрафи). Наприклад, подія на постійній основі - "Запізнився на роботу", "Не прибрав в кімнаті"
- завдання можуть бути "обов'язковими" (адмін групи може назначити виконавців), тобто за невиконання завдання в термін - штраф
- завдання можуть бути командними - можливість об'єднувати користувачів у команди для виконання спільних завдань або участі у змаганнях між командами/користувачами всередині групи
- можливість налаштувати додаткові бонуси за послідовне виконання завдань без пропусків (наприклад, весь тиждень кожен день виконується завдання "прибрати в кімнаті")
- адмін також може виконувати задачі/події і також отримувати бонуси чи штрафи

Виконання завдань:
- багато до багатьох (завдання - користувач).
- (всі ролі в рамках групи) перегляд список/детально
- (всі ролі в рамках групи) користувач ставить статус "в роботі" (дія "взяти у роботу" в завданні)
- (всі ролі в рамках групи) користувач ставить статус "перевірка" (дія "виконано" в завданні)
- (всі ролі в рамках групи) користувач ставить статус "скасовано" (дія "відмовитися" в завданні)
- (адмін групи) адмін перевіряє і ставить статус "підтверджено" (дія "виконано" в завданні)
- (адмін групи) адмін перевіряє і ставить статус "відхилено" (дія "відхилити" в завданні)
- (адмін групи) адмін перевіряє і ставить статус "заблоковано" (дія "заблокувати" в завданні)
- за виконані командні завдання бонуси отримують усі учасники команди в рівних долях

Нагороди:
- належить до якоїсь групи
- (адмін групи) створення/редагування/видалення/блокування
- (всі ролі в рамках групи) перегляд список/детально
- (всі ролі в рамках групи) можна обрати нагороду з доступного списку (і обміняти на бонуси на своєму рахунку)
- нагороди можуть бути разові, обмеженої кількості та постійні (налаштовується адміном групи)

Рахунок:
- належить до якоїсь групи
- створюється автоматично для кожного користувача (в рамках кожної групи),
тобто якщо користувач є користувачем в трьох різних групах, то у нього буде три рахунки (по одному для кожної групи)
- (адмін групи) перегляд список/детально рахунків користувачів в рамках доступної групи, формування виписки
- (всі ролі в рамках групи) перегляд інформації по своєму рахунку, формування виписки
- (superadmin/адмін групи) усі рахунки згруповані по групах (у вигляді "дерева") та в рамках своїх доступів
- на рахунках накопичуються зароблені бонуси (або борг)
- система "подяки", тобто користувачі можуть дякувати один одному невеликою кількістю бонусів за допомогу чи хорошу роботу поза основними завданнями

Транзакції:
- належить до якоїсь групи
- всі рухи бонусів на рахунки/з рахунків відбувається через транзакції
- на основі транзакцій формуються виписки по рахунках

Повідомлення:
- належить до якоїсь групи
- коли користувач позначає, що він виконав завдання (статус "перевірка"), то адміну групи приходить сповіщення, що треба перевірити та підтвердити завдання щоб зарахувались бонуси
- коли адміністратор групи підтверджує/відхиляє виконання завдання яке користувач помітив як "виконано", то користувачу приходить сповіщення
- користувачу приходять сповіщення про всі рухи по рахунку (+ та -)
- користувачу приходять сповіщення коли закінчується строк завдання (налаштовується в профілі користувача)

Звіти:
- детальні звіти по активності користувачів, популярності завдань/нагород, динаміці накопичення бонусів, виявлення "відстаючих" або "неактивних" користувачів і т.д.
- Персоналізовані звіти для користувачів (користувачі можуть бачити більш детальну статистику власного прогресу, порівняння з середніми показниками по групі, анонімізовано)

------------------------------------------------------------------------------------------------------------------------
Ініціалізації початкових даних (може виконувати суперадмін по кнопці, а також при запуску системи):
- запускається разом із системою та перевіряє чи створені/заповнені довідники
- (довідник) ролі користувачів - superadmin (вся система), admin (група), user (група);
- (довідник) тип групи - сім'я, група, відділ, організація;
- (довідник) тип завдання - завдання, підзавдання, складне завдання, командне завдання, подія, штраф;
- (довідник) тип бонусів - бонуси, бони, бали, очки, зірочки;
- (довідник) статуси - створено, в роботі, перевірка, підтверджено, відхилено, заблоковано, скасовано, видалено
- (довідник чи enum) тип користувачів - superadmin, адмін, користувач, бот;
Також при ініціалізації треба створювати користувачів odin (superadmin), shadow (системний бот-адмін, під ним будуть виконуватися фонові задачі, крон, та інше)

- Коли запускається докер контейнер, то повинні виконуватися такі дії (підготовлені скрипти): 
- перевіряється чи створена БД (назва БД в константах) - якщо ще не створено, то створюється
- перевіряється чи створені усі таблиці, зв'язки і т.д. в БД - якщо ще не створено, то створюється (виконуються міграції alembic)
- перевіряється чи заповнені довідники - якщо ще не заповнено, то заповнити/оновити
- перевіряється чи створені користувачі odin, shadow - якщо ще не створено, то створюється

------------------------------------------------------------------------------------------------------------------------
Треба врахувати:
- базовий клас BaseMain з полями - id, name, description, created_at, updated_at і т.д.
- базовий клас для довідників (наслідується від базового класу BaseMain) з полями - code і т.д.
- базовий клас для об'єктів (наслідується від базового класу BaseMain) з полями - state (статус), група до якої належить об'єкт, deleted_at, notes і т.д.
- винести в базові класи спільні поля/методи/правила
- потрібен метод ініціалізації початкових даних (котрий буде запускатися з системою і перевіряти чи створені та заповнені довідники)
- загальну схему структури проекту в зручному візуальному вигляді з детальними коментарями
